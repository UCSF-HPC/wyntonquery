<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Henrik Bengtsson" />

<meta name="date" content="2021-06-18" />

<title>SGE Accounting File</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">SGE Accounting File</h1>
<h4 class="author">Henrik Bengtsson</h4>
<h4 class="date">2021-06-18</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The SGE accounting file holds information on all submitted and <em>finished</em> jobs submitted to the SGE scheduler. Queued or currently running jobs are <em>not</em> included in this file. A job is considered &quot;finished&quot; if it completed successfully, terminated due to an error, or was cancelled. The file is a colon-delimited text file with one job entry per row, with the most recently finished job appended at end. Contrary to what one might expect, the file is not <em>perfectly</em> ordered by the <code>end_time</code> of the jobs. We might find some entries where the <code>end_time</code> of two consequentive entries might differ by a few seconds in the &quot;wrong&quot; order. It's not clear to me why this is but it might be that the scheduler updates the SGE accounting file at regular intervals, say every few minutes, and when it does it goes through the jobs in order of job index.</p>
</div>
<div id="indexing-the-sge-accounting-file" class="section level2">
<h2>Indexing the SGE accounting file</h2>
<p>In March 2020, it was ~12 GB and took 6-8 minutes to read in full. As of June 2021, the Wynton HPC accounting file is ~54 GB with 160.5 million job entries. It is rare to be interested in all entries. It is more common to work with a subset of the job entries. In order to do this efficiently, we start by indexing the SGE accounting using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(wyntonquery)
progressr<span class="op">::</span><span class="kw">handlers</span>(<span class="dt">global =</span> <span class="ot">TRUE</span>) ## Report on progress

pathname &lt;-<span class="st"> </span><span class="kw">sge_accounting_file</span>()
<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&quot;File size: %.3g GB</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">file.size</span>(pathname)<span class="op">/</span><span class="dv">1024</span><span class="op">^</span><span class="dv">3</span>))
<span class="co"># File size: 54.1 GB</span>

## It takes 5-10 minutes to index a 54 GB SGE accounting file
index &lt;-<span class="st"> </span><span class="kw">make_file_index</span>(pathname, <span class="dt">skip =</span> 4L)
<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&quot;Number of job entries: %d</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">length</span>(index)))
<span class="co"># Number of job entries: 160835061</span>

## Save index to file for future use
<span class="kw">save_file_index</span>(index, <span class="dt">file =</span> <span class="st">&quot;accounting.index&quot;</span>)</code></pre></div>
</div>
<div id="reading-job-entries-in-sge-accounting-file" class="section level2">
<h2>Reading job entries in SGE accounting file</h2>
<p>Here is how we can read the ~100,000 most recent entries, which only takes a few seconds:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(wyntonquery)

pathname &lt;-<span class="st"> </span><span class="kw">sge_accounting_file</span>()
index &lt;-<span class="st"> </span><span class="kw">read_file_index</span>(<span class="st">&quot;accounting.index&quot;</span>)

from &lt;-<span class="st"> </span><span class="fl">100e3</span>
jobs &lt;-<span class="st"> </span><span class="kw">read_sge_accounting</span>(pathname, <span class="dt">offset =</span> index[<span class="kw">length</span>(index)<span class="op">+</span><span class="dv">1</span><span class="op">-</span>from])
<span class="kw">print</span>(jobs)
<span class="co"># A tibble: 103,419 x 45</span>
   qname  hostname  group  owner job_name   job_number account priority submission_time     start_time          end_time            failed exit_status
   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">           </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">      </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dttm<span class="op">&gt;</span><span class="st">              </span><span class="er">&lt;</span>dttm<span class="op">&gt;</span><span class="st">              </span><span class="er">&lt;</span>dttm<span class="op">&gt;</span><span class="st">               </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">       </span><span class="er">&lt;</span>int<span class="op">&gt;</span>
<span class="st"> </span><span class="dv">1</span> long.q qb3<span class="op">-</span>id149 group… owne… ddG_satur…     <span class="dv">273941</span> sge           <span class="dv">19</span> <span class="dv">2021-06-17</span> <span class="dv">10</span><span class="op">:</span><span class="dv">15</span><span class="op">:</span><span class="dv">11</span> <span class="dv">2021-06-17</span> <span class="dv">16</span><span class="op">:</span><span class="dv">07</span><span class="op">:</span><span class="dv">29</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">24</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">2</span> long.q qb3<span class="op">-</span>id26  group… owne… ddG_satur…     <span class="dv">273941</span> sge           <span class="dv">19</span> <span class="dv">2021-06-17</span> <span class="dv">10</span><span class="op">:</span><span class="dv">15</span><span class="op">:</span><span class="dv">11</span> <span class="dv">2021-06-17</span> <span class="dv">16</span><span class="op">:</span><span class="dv">33</span><span class="op">:</span><span class="dv">13</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">23</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">3</span> long.q qb3<span class="op">-</span>id78  group… owne… batch_3d       <span class="dv">275353</span> sge           <span class="dv">19</span> <span class="dv">2021-06-17</span> <span class="dv">11</span><span class="op">:</span><span class="dv">38</span><span class="op">:</span><span class="dv">15</span> <span class="dv">2021-06-17</span> <span class="dv">18</span><span class="op">:</span><span class="dv">58</span><span class="op">:</span><span class="dv">08</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">24</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">4</span> short… qb3<span class="op">-</span>id164 group… owne… min111         <span class="dv">280589</span> sge           <span class="dv">10</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">09</span><span class="op">:</span><span class="dv">28</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">10</span><span class="op">:</span><span class="dv">34</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">25</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">5</span> long.q qb3<span class="op">-</span>id176 group… owne… ddG_satur…     <span class="dv">273941</span> sge           <span class="dv">19</span> <span class="dv">2021-06-17</span> <span class="dv">10</span><span class="op">:</span><span class="dv">15</span><span class="op">:</span><span class="dv">11</span> <span class="dv">2021-06-17</span> <span class="dv">16</span><span class="op">:</span><span class="dv">44</span><span class="op">:</span><span class="dv">48</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">25</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">6</span> short… qb3<span class="op">-</span>id176 group… owne… min153         <span class="dv">280621</span> sge           <span class="dv">10</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">09</span><span class="op">:</span><span class="dv">38</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">10</span><span class="op">:</span><span class="dv">34</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">25</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">7</span> long.q qb3<span class="op">-</span>ih59  group… owne… batch_3d       <span class="dv">274703</span> sge           <span class="dv">19</span> <span class="dv">2021-06-17</span> <span class="dv">11</span><span class="op">:</span><span class="dv">28</span><span class="op">:</span><span class="dv">06</span> <span class="dv">2021-06-17</span> <span class="dv">18</span><span class="op">:</span><span class="dv">25</span><span class="op">:</span><span class="dv">42</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">25</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">8</span> short… qb3<span class="op">-</span>ih35  group… owne… min133         <span class="dv">280751</span> sge           <span class="dv">10</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">10</span><span class="op">:</span><span class="dv">17</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">22</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">26</span>      <span class="dv">0</span>         <span class="dv">132</span>
 <span class="dv">9</span> short… qb3<span class="op">-</span>ih29  group… owne… min62          <span class="dv">280708</span> sge           <span class="dv">10</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">10</span><span class="op">:</span><span class="dv">04</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">22</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">26</span>      <span class="dv">0</span>         <span class="dv">132</span>
<span class="dv">10</span> short… qb3<span class="op">-</span>ih29  group… owne… min69          <span class="dv">280714</span> sge           <span class="dv">10</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">10</span><span class="op">:</span><span class="dv">06</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">22</span> <span class="dv">2021-06-17</span> <span class="dv">19</span><span class="op">:</span><span class="dv">13</span><span class="op">:</span><span class="dv">26</span>      <span class="dv">0</span>         <span class="dv">132</span>
<span class="co"># … with 103,409 more rows, and 32 more variables: ru_wallclock &lt;drtn&gt;, ru_utime &lt;drtn&gt;, ru_stime &lt;drtn&gt;, ru_maxrss &lt;chr&gt;,</span>
<span class="co">#   ru_ixrss &lt;chr&gt;, ru_ismrss &lt;chr&gt;, ru_idrss &lt;chr&gt;, ru_isrss &lt;chr&gt;, ru_minflt &lt;dbl&gt;, ru_majflt &lt;dbl&gt;, ru_nswap &lt;dbl&gt;, ru_inblock &lt;dbl&gt;,</span>
<span class="co">#   ru_oublock &lt;dbl&gt;, ru_msgsnd &lt;dbl&gt;, ru_msgrcv &lt;dbl&gt;, ru_nsignals &lt;dbl&gt;, ru_nvcsw &lt;dbl&gt;, ru_nivcsw &lt;dbl&gt;, project &lt;chr&gt;,</span>
<span class="co">#   department &lt;chr&gt;, granted_pe &lt;chr&gt;, slots &lt;int&gt;, task_number &lt;int&gt;, cpu &lt;drtn&gt;, mem &lt;chr&gt;, io &lt;chr&gt;, category &lt;chr&gt;, iow &lt;drtn&gt;,</span>
<span class="co">#   pe_taskid &lt;chr&gt;, maxvmem &lt;dbl&gt;, arid &lt;dbl&gt;, ar_sub_time &lt;dttm&gt;</span></code></pre></div>
<p><em>Comment:</em> The reason for getting more than 100,000 job entries is that the SGE accounting file had recorded another 3,419 jobs since we last indexed the file.</p>
<p>To read, say, 10,000 jobs starting with job entry 120,000,000, use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">from &lt;-<span class="st"> </span><span class="dv">120000000</span>
jobs &lt;-<span class="st"> </span><span class="kw">read_sge_accounting</span>(pathname, <span class="dt">offset =</span> index[from], <span class="dt">n_max =</span> <span class="dv">10000</span>)
<span class="kw">print</span>(jobs)
<span class="co"># A tibble: 10,000 x 45</span>
   qname    hostname  group  owner job_name job_number account priority submission_time     start_time          end_time            failed exit_status
   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">         </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">      </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dttm<span class="op">&gt;</span><span class="st">              </span><span class="er">&lt;</span>dttm<span class="op">&gt;</span><span class="st">              </span><span class="er">&lt;</span>dttm<span class="op">&gt;</span><span class="st">               </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">       </span><span class="er">&lt;</span>int<span class="op">&gt;</span>
<span class="st"> </span><span class="dv">1</span> long.q   qb3<span class="op">-</span>id146 bks    jji   batch_3d    <span class="dv">2514714</span> sge           <span class="dv">19</span> <span class="dv">2021-03-18</span> <span class="dv">05</span><span class="op">:</span><span class="dv">17</span><span class="op">:</span><span class="dv">48</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">09</span><span class="op">:</span><span class="dv">45</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">40</span><span class="op">:</span><span class="dv">23</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">2</span> long.q   qb3<span class="op">-</span>id66  bks    jji   batch_3d    <span class="dv">2514751</span> sge           <span class="dv">19</span> <span class="dv">2021-03-18</span> <span class="dv">05</span><span class="op">:</span><span class="dv">26</span><span class="op">:</span><span class="dv">06</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">20</span><span class="op">:</span><span class="dv">45</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">40</span><span class="op">:</span><span class="dv">23</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">3</span> member.q qb3<span class="op">-</span>id70  modweb modw… TB_2julA    <span class="dv">2515048</span> sge            <span class="dv">0</span> <span class="dv">2021-03-18</span> <span class="dv">06</span><span class="op">:</span><span class="dv">47</span><span class="op">:</span><span class="dv">47</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">38</span><span class="op">:</span><span class="dv">45</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">40</span><span class="op">:</span><span class="dv">23</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">4</span> long.q   qb3<span class="op">-</span>ad9   bks    jji   batch_3d    <span class="dv">2514714</span> sge           <span class="dv">19</span> <span class="dv">2021-03-18</span> <span class="dv">05</span><span class="op">:</span><span class="dv">17</span><span class="op">:</span><span class="dv">48</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">10</span><span class="op">:</span><span class="dv">45</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">40</span><span class="op">:</span><span class="dv">24</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">5</span> member.q qb3<span class="op">-</span>id195 modweb modw… TB_2julA    <span class="dv">2515048</span> sge            <span class="dv">0</span> <span class="dv">2021-03-18</span> <span class="dv">06</span><span class="op">:</span><span class="dv">47</span><span class="op">:</span><span class="dv">47</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">38</span><span class="op">:</span><span class="dv">45</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">40</span><span class="op">:</span><span class="dv">25</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">6</span> long.q   qb3<span class="op">-</span>id83  bks    jji   batch_3d    <span class="dv">2514820</span> sge           <span class="dv">19</span> <span class="dv">2021-03-18</span> <span class="dv">05</span><span class="op">:</span><span class="dv">36</span><span class="op">:</span><span class="dv">24</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">30</span><span class="op">:</span><span class="dv">45</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">40</span><span class="op">:</span><span class="dv">26</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">7</span> long.q   qb3<span class="op">-</span>id31  bks    jji   batch_3d    <span class="dv">2514820</span> sge           <span class="dv">19</span> <span class="dv">2021-03-18</span> <span class="dv">05</span><span class="op">:</span><span class="dv">36</span><span class="op">:</span><span class="dv">24</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">29</span><span class="op">:</span><span class="dv">45</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">40</span><span class="op">:</span><span class="dv">26</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">8</span> long.q   qb3<span class="op">-</span>id124 bks    jji   batch_3d    <span class="dv">2514827</span> sge           <span class="dv">19</span> <span class="dv">2021-03-18</span> <span class="dv">05</span><span class="op">:</span><span class="dv">38</span><span class="op">:</span><span class="dv">30</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">33</span><span class="op">:</span><span class="dv">45</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">40</span><span class="op">:</span><span class="dv">26</span>      <span class="dv">0</span>           <span class="dv">0</span>
 <span class="dv">9</span> long.q   qb3<span class="op">-</span>id52  bks    jji   batch_3d    <span class="dv">2514820</span> sge           <span class="dv">19</span> <span class="dv">2021-03-18</span> <span class="dv">05</span><span class="op">:</span><span class="dv">36</span><span class="op">:</span><span class="dv">24</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">29</span><span class="op">:</span><span class="dv">45</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">40</span><span class="op">:</span><span class="dv">26</span>      <span class="dv">0</span>           <span class="dv">0</span>
<span class="dv">10</span> long.q   cc<span class="op">-</span>id1    bks    jji   batch_3d    <span class="dv">2514783</span> sge           <span class="dv">19</span> <span class="dv">2021-03-18</span> <span class="dv">05</span><span class="op">:</span><span class="dv">30</span><span class="op">:</span><span class="dv">12</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">23</span><span class="op">:</span><span class="dv">45</span> <span class="dv">2021-03-18</span> <span class="dv">07</span><span class="op">:</span><span class="dv">40</span><span class="op">:</span><span class="dv">27</span>      <span class="dv">0</span>           <span class="dv">0</span>
<span class="co"># … with 9,990 more rows, and 32 more variables: ru_wallclock &lt;drtn&gt;, ru_utime &lt;drtn&gt;, ru_stime &lt;drtn&gt;, ru_maxrss &lt;chr&gt;, ru_ixrss &lt;chr&gt;,</span>
<span class="co">#   ru_ismrss &lt;chr&gt;, ru_idrss &lt;chr&gt;, ru_isrss &lt;chr&gt;, ru_minflt &lt;dbl&gt;, ru_majflt &lt;dbl&gt;, ru_nswap &lt;dbl&gt;, ru_inblock &lt;dbl&gt;, ru_oublock &lt;dbl&gt;,</span>
<span class="co">#   ru_msgsnd &lt;dbl&gt;, ru_msgrcv &lt;dbl&gt;, ru_nsignals &lt;dbl&gt;, ru_nvcsw &lt;dbl&gt;, ru_nivcsw &lt;dbl&gt;, project &lt;chr&gt;, department &lt;chr&gt;, granted_pe &lt;chr&gt;,</span>
<span class="co">#   slots &lt;int&gt;, task_number &lt;int&gt;, cpu &lt;drtn&gt;, mem &lt;chr&gt;, io &lt;chr&gt;, category &lt;chr&gt;, iow &lt;drtn&gt;, pe_taskid &lt;chr&gt;, maxvmem &lt;dbl&gt;, arid &lt;dbl&gt;,</span>
<span class="co">#   ar_sub_time &lt;dttm&gt;</span></code></pre></div>
</div>
<div id="statistics-of-jobs-finished-during-the-last-24-hours" class="section level2">
<h2>Statistics of jobs finished during the last 24 hours</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(wyntonquery)

pathname &lt;-<span class="st"> </span><span class="kw">sge_accounting_file</span>()
index &lt;-<span class="st"> </span><span class="kw">read_file_index</span>(<span class="st">&quot;accounting.index&quot;</span>)

## Read enough job entries to cover 24 hours and more
from &lt;-<span class="st"> </span><span class="fl">300e3</span>
jobs &lt;-<span class="st"> </span><span class="kw">read_sge_accounting</span>(pathname, <span class="dt">offset =</span> index[<span class="kw">length</span>(index)<span class="op">+</span><span class="dv">1</span><span class="op">-</span>from])

period &lt;-<span class="st"> </span><span class="kw">range</span>(jobs<span class="op">$</span>end_time, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&quot;Period: %s/%s</span><span class="ch">\n</span><span class="st">&quot;</span>, period[<span class="dv">1</span>], period[<span class="dv">2</span>]))
## Period: 2021-06-17 04:23:00/2021-06-18 09:26:06

## Keep jobs for the last 24 hours
jobs &lt;-<span class="st"> </span><span class="kw">subset</span>(jobs, end_time <span class="op">&gt;=</span><span class="st"> </span>period[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">24</span><span class="op">*</span><span class="dv">3600</span>)
period &lt;-<span class="st"> </span><span class="kw">range</span>(jobs<span class="op">$</span>end_time, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&quot;Period: %s/%s</span><span class="ch">\n</span><span class="st">&quot;</span>, period[<span class="dv">1</span>], period[<span class="dv">2</span>]))
## Period: 2021-06-15 19:35:15/2021-06-16 19:35:15
<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&quot;Number of jobs finished during this period: %d</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">nrow</span>(jobs)))
## Number of jobs finished during this period: 197538

nusers &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(jobs<span class="op">$</span>owner))
<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&quot;Number of unique users: %d</span><span class="ch">\n</span><span class="st">&quot;</span>, nusers))
<span class="co"># Number of unique users: 79</span></code></pre></div>
<p>Let's see how many of the jobs finished succesfully and how many failed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Get successful and failed jobs
groups &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">success =</span> <span class="kw">subset</span>(jobs, failed <span class="op">==</span><span class="st"> </span>0L),
  <span class="dt">fail    =</span> <span class="kw">subset</span>(jobs, failed <span class="op">&gt;</span><span class="st"> </span>0L)
)
stats &lt;-<span class="st"> </span><span class="kw">sapply</span>(groups, nrow)
<span class="kw">print</span>(stats)
<span class="co"># success    fail </span>
<span class="co">#  191701    5837 </span>

<span class="kw">print</span>(stats<span class="op">/</span><span class="kw">sum</span>(stats))
<span class="co">#    success       fail </span>
<span class="co"># 0.97045125 0.02954875</span></code></pre></div>
<p>We see that failure rate among the ~200,000 jobs that ran the last 24 hours was ~3%. Next, let's see how much CPU time this correspondsa to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## CPU time consumed
cpu &lt;-<span class="st"> </span><span class="kw">sapply</span>(groups, <span class="cf">function</span>(jobs) { d &lt;-<span class="st"> </span><span class="kw">sum</span>(jobs<span class="op">$</span>cpu); <span class="kw">units</span>(d) &lt;-<span class="st"> &quot;days&quot;</span>; d })
<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&quot;Total CPU processing time: %.1f hours</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">sum</span>(cpu)))
<span class="co"># Total CPU processing time: 7937.3 hours</span>

<span class="kw">print</span>(cpu)
<span class="co">#   success      fail </span>
<span class="co"># 7562.2252  375.1175</span>

## CPU-time fractions
<span class="kw">print</span>(cpu <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(cpu))
<span class="co">#    success       fail </span>
<span class="co"># 0.95274017 0.04725983</span></code></pre></div>
<p>From this, we find that during the last 24 hours, ~5% of the CPU time was consumed by jobs that failed. Among the failed jobs, the failure code was distributed as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">table</span>(groups<span class="op">$</span>fail<span class="op">$</span>failed))
<span class="co">#   25   26   37  100 </span>
<span class="co">#    5    1 4440 1391</span></code></pre></div>
<p>From <code>help(&quot;read_sge_accounting&quot;, package=&quot;wyntonquery&quot;)</code> for details on the parsed fields and their data types, these description of some of these codes are:</p>
<ul>
<li>25: rescheduling</li>
<li>26: failed opening stderr/stdout file</li>
<li>37: ran but killed because it exceeded the maximum run time (<code>h_rt</code>), maximum CPU time (<code>h_cpu</code>), or maximum virtual memory (<code>h_vmem</code>)</li>
<li>100: ran, but killed by a signal (perhaps due to exceeding resources), task died, shepherd died (e.g. node crash), etc.</li>
</ul>
<p>The jobs that exhausted their limits, consumed 213 days of CPU time;</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">subset</span>(groups<span class="op">$</span>fail, failed <span class="op">==</span><span class="st"> </span><span class="dv">37</span>)<span class="op">$</span>cpu); <span class="kw">units</span>(d) &lt;-<span class="st"> &quot;days&quot;</span>
<span class="kw">print</span>(d)
<span class="co"># Time difference of 212.8236 days</span></code></pre></div>
<p>which corresponds to ~3% of all CPU time spent:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">as.numeric</span>(d<span class="op">/</span><span class="kw">sum</span>(cpu))
[<span class="dv">1</span>] <span class="fl">0.02681296</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
